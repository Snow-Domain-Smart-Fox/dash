<!doctype html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0" />
	<meta name="description" content="Amazing Luogu 国际" />
	<link rel="icon" type="image/svg+xml" href="./icon.png" />
	<title>Amazing Luogu</title>
	<link rel="stylesheet" href="https://cdn.jsdmirror.cn/npm/@fortawesome/fontawesome-free@7.2.0/css/all.min.css" />
	<link rel="preload" href="https://cdn.jsdmirror.cn/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css" as="style"
		crossorigin="anonymous" onload="this.rel='stylesheet'" />
	<link rel="preload"
		href="https://cdn.jsdmirror.cn/gh/highlightjs/cdn-release@11.8.0/build/styles/atom-one-light.min.css" as="style"
		crossorigin="anonymous" onload="this.rel='stylesheet'" />
	<link rel="preload"
		href="https://cdn.jsdmirror.cn/gh/highlightjs/cdn-release@11.8.0/build/styles/github-dark.min.css" as="style"
		crossorigin="anonymous" onload="this.rel='stylesheet'" />
	<link rel="stylesheet"
		href="https://cdn.jsdmirror.cn/gh/zym2013/amazing-luogu-international@main/style/markdown.css" />
	<link rel="stylesheet"
		href="https://cdn.jsdmirror.cn/gh/zym2013/amazing-luogu-international@main/style/framework.css" />
	<link rel="preload" href="https://cdn.jsdmirror.cn/npm/katex@0.16.27/dist/katex.min.css" as="style"
		crossorigin="anonymous" onload="this.rel='stylesheet'" />
	<link rel="stylesheet" href="https://cdn.jsdmirror.cn/npm/animate.css@4.1.1/animate.min.css" />
	<style>
		:root {
			--bg-color: #fff;
			--card-bg: #fff;
			--text-color: #24292f;
			--text-light: #656d76;
			--border-color: #d0d7de;
			--primary-color: #0969da;
			--border-radius-sm: 8px
		}

		body {
			margin: 0;
			font-family: LXGW WenKai Screen, system-ui, -apple-system, sans-serif;
			background: var(--bg-color);
			color: var(--text-color);
			line-height: 1.5
		}

		.markdown-body {
			font-size: 16px;
			line-height: 1.6;
			color: var(--text-color)
		}

		#goBtn {
			position: absolute;
			right: 68px;
			top: 3px;
			bottom: 4px;
			padding: 0 16px;
			background: var(--primary-color);
			color: #fff;
			border: none;
			border-radius: var(--border-radius-sm);
			cursor: pointer;
			font-weight: 500;
			transition: background .2s
		}

		#urlInput {
			width: 73%;
			padding: 12px 16px;
			font-size: 1rem;
			border: 1px solid var(--border-color);
			border-radius: var(--border-radius-sm);
			background: var(--card-bg);
			color: var(--text-color);
			box-shadow: inset 0 1px 2px rgba(0, 0, 0, .05);
			transition: border-color .2s
		}

		.markdown-body .katex-display {
			overflow-x: auto;
			overflow-y: hidden
		}

		.katex-display .katex {
			display: block
		}

		.notice {
			margin-block: 1em;
			margin-inline: 40px;
			unicode-bidi: isolate;
			padding: 10px 20px;
			margin: 0 0 20px;
			border-left: 5px solid #eee;
			margin-top: 30px;
			border-radius: 15px;
			background: var(--card-bg);
			text-align: left
		}

		.notice h2 {
			margin-top: 0
		}

		.important-notice {
			border-left-color: #f85149
		}

		.important-notice i {
			color: #f85149
		}

		.flowing-light {
			animation: flowing-light 1s ease-in-out infinite alternate .1s;
			color: #444;
			text-shadow: 0 0 0 #444
		}

		@keyframes flowing-light {
			to {
				text-shadow: 0 0 1px #fff, 0 0 1px #fff, 0 0 3px #fff, 0 0 6px #126fcc, 0 0 7px #126fcc, 0 0 11px #126fcc;
				color: #aaa
			}
		}

		.page-layout {
			display: flex;
			gap: 24px;
			max-width: 1400px;
			margin: 0 auto
		}

		.main-content {
			flex: 1;
			min-width: 0
		}

		.toc-sidebar {
			width: 240px;
			flex-shrink: 0;
			position: sticky;
			top: 80px;
			align-self: flex-start;
			background: var(--card-bg);
			border-radius: var(--border-radius-sm);
			padding: 16px;
			box-shadow: 0 2px 8px rgba(0, 0, 0, .08);
			max-height: calc(100vh - 100px);
			overflow-y: auto
		}

		.toc-sidebar h4 {
			margin: 0 0 12px;
			font-size: 1rem;
			color: var(--text-color);
			border-bottom: 1px solid var(--border-color);
			padding-bottom: 8px
		}

		.toc-content a {
			display: block;
			padding: 4px 0;
			color: var(--text-light);
			text-decoration: none;
			font-size: .9rem;
			transition: color .2s
		}

		.toc-content a:hover {
			color: var(--primary-color)
		}

		.toc-content .h2 {
			padding-left: 12px
		}

		.toc-content .h3 {
			padding-left: 24px
		}

		.toc-content .h4 {
			padding-left: 36px
		}

		.toc-content .h5 {
			padding-left: 48px
		}

		.toc-content .h6 {
			padding-left: 60px
		}

		.article-header {
			display: flex;
			flex-wrap: wrap;
			gap: 8px;
			align-items: center;
			margin-bottom: 16px;
			padding-bottom: 12px;
			border-bottom: 1px solid var(--border-color)
		}

		.action-btn {
			padding: 6px 12px;
			background: var(--card-bg);
			border: 1px solid var(--border-color);
			border-radius: var(--border-radius-sm);
			color: var(--text-color);
			cursor: pointer;
			font-size: .9rem;
			transition: all .2s;
			display: inline-flex;
			align-items: center;
			gap: 6px
		}

		.action-btn:hover {
			background: var(--primary-color);
			border-color: var(--primary-color);
			color: #fff
		}

		.save-time {
			margin-left: auto;
			font-size: .85rem;
			color: var(--text-light)
		}

		@media(max-width:1100px) {
			.page-layout {
				flex-direction: column
			}

			.toc-sidebar {
				width: 100%;
				position: static;
				max-height: 300px
			}

			.save-time {
				margin-left: 0;
				width: 100%;
				text-align: right
			}
		}

		.markdown-body h1,
		.markdown-body h2,
		.markdown-body h3,
		.markdown-body h4,
		.markdown-body h5,
		.markdown-body h6 {
			scroll-margin-top: 80px;
			scroll-padding-top: 80px
		}

		.global-loading {
			position: fixed;
			inset: 0;
			background: var(--bg-color);
			display: flex;
			align-items: center;
			justify-content: center;
			z-index: 9999;
			transition: opacity .3s, visibility .3s
		}

		.global-loading.hidden {
			opacity: 0;
			visibility: hidden;
			pointer-events: none
		}

		.loading-spinner {
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 16px;
			color: var(--text-color)
		}

		.loading-spinner i {
			font-size: 2.5rem;
			color: var(--primary-color)
		}

		.loading-spinner span {
			font-size: 1rem;
			color: var(--text-light)
		}

		.loading {
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 40px;
			color: var(--text-light);
			gap: 12px
		}

		.loading i {
			color: var(--primary-color);
			animation: spin 1s linear infinite
		}

		@keyframes spin {
			to {
				transform: rotate(360deg)
			}
		}

		#not-found-page {
			animation: fadeIn .3s ease-out
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(10px)
			}

			to {
				opacity: 1;
				transform: translateY(0)
			}
		}

		button {
			font-family: LXGW Wenkai Screen
		}

		@media(prefers-color-scheme:dark) {
			:root {
				--bg-color: #0d1117;
				--card-bg: #161b22;
				--text-color: #e6edf3;
				--text-light: #8b949e;
				--border-color: #30363d;
				--primary-color: #58a6ff
			}

			.hljs,
			.code-container,
			pre {
				background: #282c34 !important;
				color: #abb2bf !important
			}

			.markdown-body code {
				background-color: #282c34;
				color: #abb2bf
			}

			.markdown-body blockquote {
				color: #999;
				border-left-color: #444
			}

			.markdown-body th,
			.markdown-body td {
				border-color: #444
			}

			.service-card {
				background: #161b22;
				border-color: #30363d
			}

			.service-card:hover {
				border-color: #58a6ff
			}

			.search-input,
			.filter-select {
				background: #161b22;
				border-color: #30363d;
				color: #e6edf3
			}
		}

		.page-header {
			margin-bottom: 24px;
			padding-bottom: 16px;
			border-bottom: 1px solid var(--border-color)
		}

		.page-header h1 {
			margin: 0 0 8px;
			font-size: 1.5rem;
			color: var(--text-color);
			display: flex;
			align-items: center;
			gap: 12px
		}

		.page-subtitle {
			margin: 0;
			color: var(--text-light);
			font-size: .95rem
		}

		.services-filter {
			display: flex;
			gap: 12px;
			margin-bottom: 20px;
			flex-wrap: wrap
		}

		.search-input,
		.filter-select {
			padding: 8px 12px;
			border: 1px solid var(--border-color);
			border-radius: var(--border-radius-sm);
			background: var(--card-bg);
			color: var(--text-color);
			font-size: .9rem;
		}

		.services-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
			gap: 16px
		}

		.service-card {
			background: var(--card-bg);
			border-radius: var(--border-radius-sm);
			padding: 16px;
			border: 1px solid var(--border-color);
			transition: transform .2s, box-shadow .2s;
			cursor: pointer
		}

		.service-card:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(0, 0, 0, .1);
			border-color: var(--primary-color)
		}

		.service-card-header {
			display: flex;
			align-items: center;
			gap: 10px;
			margin-bottom: 12px
		}

		.service-card-header i {
			font-size: 1.2rem;
			color: var(--primary-color)
		}

		.service-card-title {
			font-weight: 600;
			color: var(--text-color);
			margin: 0;
			font-size: 1.1rem
		}

		.service-card-desc {
			color: var(--text-light);
			font-size: .9rem;
			margin: 0 0 12px;
			line-height: 1.5
		}

		.service-tags {
			display: flex;
			flex-wrap: wrap;
			gap: 6px
		}

		.service-tag {
			padding: 2px 8px;
			background: var(--border-color);
			border-radius: 12px;
			font-size: .75rem;
			color: var(--text-color)
		}

		.service-meta {
			display: flex;
			gap: 16px;
			flex-wrap: wrap;
			margin-bottom: 20px;
			padding: 12px 16px;
			background: var(--card-bg);
			border-radius: var(--border-radius-sm);
			font-size: .9rem;
			color: var(--text-light)
		}

		.service-meta span {
			display: flex;
			align-items: center;
			gap: 6px
		}

		.service-meta i:not(.status-badge i) {
			color: var(--primary-color)
		}

		.empty-state {
			text-align: center;
			padding: 60px 20px;
			color: var(--text-light)
		}

		.empty-state i {
			font-size: 3rem;
			margin-bottom: 16px;
			opacity: .6
		}

		@media(max-width:768px) {
			.services-grid {
				grid-template-columns: 1fr
			}

			.services-filter {
				flex-direction: column
			}
		}

		select {
			font-family: LXGW WenKai Screen !important;
		}

		.service-icon {
			flex-shrink: 0;
			color: var(--primary-color);
		}

		.service-icon svg {
			display: block;
			fill: none;
		}

		.service-icon i {
			display: block;
			font-size: inherit;
		}

		.service-card-icon {
			width: 28px;
			height: 28px;
			font-size: 1.2rem;
		}

		.service-meta-icon {
			width: 20px;
			height: 20px;
			font-size: 1rem;
		}

		.service-meta-item {
			display: flex;
			align-items: center;
			gap: 6px;
		}

		.service-card:hover .service-icon svg,
		.service-card:hover .service-icon i {
			transform: scale(1.1);
			transition: transform 0.2s ease;
		}

		.status-badge {
			display: inline-flex;
			align-items: center;
			gap: 4px;
			padding: 4px 10px;
			border-radius: 12px;
			font-size: 0.75rem;
			font-weight: 500;
			white-space: nowrap;
		}

		.status-badge i {
			font-size: 0.7rem;
		}

		.status-active {
			background: rgba(46, 160, 67, 0.15);
			color: #30a14e !important;
			border: 1px solid rgba(46, 160, 67, 0.3);
		}

		.status-maintenance {
			background: rgba(210, 153, 34, 0.15);
			color: #b08800 !important;
			border: 1px solid rgba(210, 153, 34, 0.3);
		}

		.status-inactive {
			background: rgba(101, 109, 118, 0.15);
			color: #656d76 !important;
			border: 1px solid rgba(101, 109, 118, 0.3);
		}

		.status-deprecated {
			background: rgba(218, 54, 51, 0.15);
			color: #cb2431 !important;
			border: 1px solid rgba(218, 54, 51, 0.3);
		}

		.service-card-meta {
			margin-bottom: 8px;
		}

		@media (prefers-color-scheme: dark) {
			.status-active {
				background: rgba(46, 160, 67, 0.25);
				color: #4ac26b !important;
			}

			.status-maintenance {
				background: rgba(210, 153, 34, 0.25);
				color: #e3b341 !important;
			}

			.status-inactive {
				background: rgba(139, 148, 158, 0.25);
				color: #8b949e !important;
			}

			.status-deprecated {
				background: rgba(248, 81, 73, 0.25);
				color: #f85149 !important;
			}
		}
	</style>
</head>

<body>
	<div id="global-loading" class="global-loading">
		<div class="loading-spinner">
			<i class="fa-solid fa-spinner fa-spin"></i>
			<span>加载中...</span>
		</div>
	</div>
	<div id="app">
		<aside class="sidebar" id="sidebar">
			<nav class="nav-menu">
				<a class="nav-logo-item" data-page="none">
					<svg xmlns="http://www.w3.org/2000/svg" width="24" class="nav-icon" height="24" viewBox="0 0 24 24">
						<path fill="currentColor"
							d="M12.424 0c-.435-.005-.964.138-1.569.65c-.967.817-2.554 3.235-3.56 4.38s-2.002 1.65-2.48 2.493c-.477.844-.824 1.598-.385 2.568s2.308 2.592 3.018 3.247s.724.566 1.24.68c.517.113 1.38.188 1.857 0c.478-.19.993-.63 1.006-1.133s-.515-1.409-.928-1.887c-.413-.479-1.213-.769-1.549-.983s-.373-.076-.463-.303s-.413-.59-.078-1.056c.336-.466 1.38-1.033 2.09-1.738s1.625-1.61 2.167-2.492s1.06-2.064 1.085-2.794C13.901.902 13.603.285 13.1.12a2.2 2.2 0 0 0-.676-.12m-.397 6.936c-.243.008-.443.037-.566.097c-.492.24-.48.997-.151 1.515s1.618 1.223 2.124 1.59c.505.366.883.292.908.607c.026.316.102.315-.757 1.287c-.86.973-3.222 3.371-4.397 4.546c-1.175 1.174-1.77 1.503-2.654 2.5S4.259 21.78 3.88 22.563s-.15.997.38 1.212c.531.214 2.11.34 2.804.075c.695-.265.822-1.034 1.365-1.666c.543-.63.721-.859 1.896-2.122c.472-.507 1.242-1.32 1.998-2.118c.048.151.126.324.243.525c.423.727 1.922 2.219 2.537 3.009s.77 1.33 1.154 1.73c.384.402.55.564 1.152.677c.602.112 1.998.188 2.459 0c.461-.189.552-.576.308-1.127c-.243-.552-1.346-1.555-1.768-2.182c-.423-.627-1.243-2.095-1.845-2.71s-1.025-.776-1.768-.977c-.43-.115-.982-.11-1.444-.034c.769-.811 1.564-1.647 2.129-2.246c1.415-1.503 2.88-2.614 3.335-3.56c.455-.948-.214-1.492-.606-2.123c-.391-.631-1.124-1.363-1.743-1.666c-.62-.303-1.151-.1-1.972-.151c-.616-.038-1.737-.197-2.467-.173" />
					</svg>
					<span class="nav-text">Amazing Luogu</span>
				</a>
				<a href="/" class="nav-item" data-page="home">
					<i class="fa-solid fa-house-chimney-user nav-icon"></i>
					<span class="nav-text">首页</span>
				</a>
				<a href="/services/list" class="nav-item" data-page="services"
					onclick="event.preventDefault();navigateToServicesList()">
					<i class="fa-solid fa-layer-group nav-icon"></i>
					<span class="nav-text">服务</span>
				</a>
			</nav>
		</aside>
		<div class="sidebar-overlay" id="sidebarOverlay"></div>
		<div class="main-container">
			<header class="topbar">
				<div class="topbar-left">
					<button class="menu-toggle" id="menuToggle" aria-label="切换菜单">
						<i class="fas fa-bars"></i>
					</button>
					<nav class="breadcrumb" id="breadcrumb"></nav>
				</div>
				<div class="logo">
					<img src="https://cdn.luogu.com.cn/upload/image_hosting/7x00uufg.png" referrerpolicy="no-referrer"
						crossorigin="anonymous" alt="Logo" class="logo-img">
				</div>
			</header>
			<main class="content" id="not-found-page" style="display:none">
				<div style="text-align:center;padding:80px 20px">
					<i class="fa-solid fa-ghost" style="font-size:4rem;color:var(--text-light);margin-bottom:24px"></i>
					<h1 style="font-size:2rem;color:var(--text-color);margin-bottom:16px">404 - 页面未找到</h1>
					<p style="color:var(--text-light);margin-bottom:32px">抱歉，您访问的页面不存在或已被移除。</p>
					<a href="/" class="action-btn" style="text-decoration:none">
						<i class="fa-solid fa-house"></i> 返回首页
					</a>
				</div>
			</main>
			<main class="content" id="home-page"></main>
			<main class="content" id="services-list-page" style="display:none">
				<div class="page-header">
					<h1>
						<i class="fa-solid fa-layer-group"></i> 服务列表
					</h1>
					<p class="page-subtitle">浏览所有可用服务，更多服务上线中……</p>
				</div>
				<div class="services-filter">
					<input type="text" id="serviceSearch" placeholder="搜索服务..." class="search-input">
					<select id="categoryFilter" class="filter-select">
						<option value="">全部分类</option>
					</select>
				</div>
				<div id="services-grid" class="services-grid"></div>
				<div id="services-loading" class="loading" style="display:none">
					<div class="loading">
						<i class="fa-solid fa-spinner"></i>
						<span>加载中...</span>
					</div>
				</div>
				<div id="services-empty" class="empty-state" style="display:none">
					<i class="fa-solid fa-inbox"></i>
					<p>暂无服务</p>
				</div>
			</main>
			<main class="content" id="services-detail-page" style="display:none">
				<div class="article-header">
					<button class="action-btn" onclick="history.back()">
						<i class="fa-solid fa-arrow-left"></i> 返回
					</button>
					<button class="action-btn" id="copyServiceLink">
						<i class="fa-solid fa-link"></i> 复制链接
					</button>
					<span class="save-time" id="serviceUpdateTime"></span>
				</div>
				<div id="service-meta" class="service-meta"></div>
				<div id="service-content" class="markdown-body"></div>
			</main>
		</div>
	</div>
	<script src="https://cdn.jsdmirror.cn/gh/zym2013/amazing-luogu-international@main/function/framework.js"></script>
	<script src="https://cdn.jsdmirror.cn/npm/marked@4.0.0/marked.min.js"></script>
	<script src="https://cdn.jsdmirror.cn/npm/katex@0.16.27/dist/katex.min.js"></script>
	<script src="https://cdn.jsdmirror.cn/npm/katex@0.16.27/dist/contrib/auto-render.min.js"></script>
	<script src="https://cdn.jsdmirror.cn/gh/highlightjs/cdn-release@11.8.0/build/highlight.min.js"></script>
	<script>
		// ============================================================
		// Amazing Luogu - 服务系统 JavaScript
		// 支持 Markdown、KaTeX、Highlight.js 和 SVG/FontAwesome 图标
		// ============================================================


		// ============================================================
		// 1. Markdown 自定义扩展
		// ============================================================
		const customExtensions = [
			{
				name: 'alignBlock',
				level: 'block',
				start: function (src) {
					return src.match(/^:::\s*align\s*\{([^}]+)\}/)?.index;
				},
				tokenizer: function (src, tokens) {
					const match = src.match(/^:::\s*align\s*\{([^}]+)\}([\s\S]*?)\n:::/);
					if (match) {
						return {
							type: 'alignBlock',
							raw: match[0],
							align: match[1].trim(),
							content: match[2].trim()
						};
					}
				},
				renderer: function (token) {
					return `<div class="align-${token.align}">${marked.parse(token.content)}</div>`;
				}
			},
			{
				name: 'epigraph',
				level: 'block',
				start: function (src) {
					return src.match(/^:::\s*epigraph(\[([^\]]+)\])?\s*:::/)?.index;
				},
				tokenizer: function (src, tokens) {
					const match = src.match(/^:::\s*epigraph(\[([^\]]+)\])?\s*([\s\S]*?)\s*:::/);
					if (match) {
						return {
							type: 'epigraph',
							raw: match[0],
							author: match[2] || '',
							content: match[3].trim()
						};
					}
				},
				renderer: function (token) {
					const authorPart = `<p>${token.author ? token.author : 'unknown author'}</p>`;
					return `<div class="epigraph">${marked.parse(token.content)}${authorPart}</div>`;
				}
			},
			{
				name: 'foldable',
				level: 'block',
				start: function (src) {
					return src.match(/^:{3,}/)?.index;
				},
				tokenizer: function (src, tokens) {
					const match = src.match(/^(:{3,})\s*(\w+)?(\[([^\]]+)\])?(\s*\{([^}]+)\})?\s*([\s\S]*?)\s*\1/);
					if (match && ['info', 'warning', 'success', 'error', 'bug', 'flask'].includes(match[2])) {
						return {
							type: 'foldable',
							raw: match[0],
							foldType: match[2] || 'info',
							title: match[4] || '',
							options: match[6] || '',
							content: match[7].trim()
						};
					}
				},
				renderer: function (token) {
					const isOpen = token.options.includes('open');
					return `
                <details class="foldable ${token.foldType}" ${isOpen ? 'open' : ''}>
                    <summary>${token.title || '点击展开'}</summary>
                    ${marked.parse(token.content)}
                </details>
            `;
				}
			}
		];

		marked.use({ extensions: customExtensions });


		// ============================================================
		// 2. 工具函数
		// ============================================================

		/**
		 * HTML 转义，防止 XSS 攻击
		 */
		function escapeHtml(str) {
			return str
				.replace(/&/g, '&amp;')
				.replace(/</g, '&lt;')
				.replace(/>/g, '&gt;')
				.replace(/"/g, '&quot;')
				.replace(/'/g, '&#039;');
		}

		/**
		 * HTML 净化，移除危险标签和属性
		 */
		function sanitizeHTML(html) {
			const parser = new DOMParser();
			const doc = parser.parseFromString(html, 'text/html');

			const dangerousTags = ['script', 'link', 'meta', 'object', 'embed', 'style'];
			dangerousTags.forEach(tag => {
				doc.querySelectorAll(tag).forEach(el => el.remove());
			});

			doc.querySelectorAll('*').forEach(el => {
				[...el.attributes].forEach(attr => {
					if (attr.name.startsWith('on')) {
						el.removeAttribute(attr.name);
					}
					if (attr.name.toLowerCase() === 'style') {
						el.removeAttribute(attr.name);
					}
					if (attr.value && typeof attr.value === 'string' && attr.value.trim().toLowerCase().startsWith('javascript:')) {
						el.removeAttribute(attr.name);
					}
				});
			});

			return doc.body.innerHTML;
		}


		// ============================================================
		// 3. Markdown 渲染配置
		// ============================================================

		const mdRenderer = new marked.Renderer();

		mdRenderer.code = function (code, language) {
			const lang = language || 'plaintext';
			let highlighted = code;

			if (language && hljs.getLanguage(lang)) {
				try {
					highlighted = hljs.highlight(code, { language: lang, ignoreIllegals: true }).value;
				} catch (e) {
					console.warn('Highlight error:', e);
				}
			}

			return `<div class="code-container"><pre><code class="language-${lang}">${highlighted}</code></pre></div>`;
		};

		marked.setOptions({
			breaks: false,
			gfm: true,
			mangle: false,
			headerIds: false,
			renderer: mdRenderer,
		});

		function renderMarkdown(text) {
			const tmp = document.createElement('div');
			tmp.innerHTML = sanitizeHTML(marked.parse(text));

			tmp.querySelectorAll('img').forEach(img => {
				img.setAttribute('referrerpolicy', 'no-referrer');
				img.setAttribute('crossorigin', 'anonymous');
			});

			renderMathInElement(tmp, {
				delimiters: [
					{ left: '$$', right: '$$', display: true },
					{ left: '$', right: '$', display: false },
					{ left: '\\(', right: '\\)', display: false },
					{ left: '\\[', right: '\\]', display: true }
				],
				strict: false
			});

			return tmp.innerHTML;
		}


		// ============================================================
		// 4. 主题与代码高亮
		// ============================================================

		function updateHighlightTheme() {
			const isDark = document.documentElement.getAttribute('data-theme') === 'dark' ||
				document.body.classList.contains('dark-mode') ||
				window.matchMedia('(prefers-color-scheme: dark)').matches;

			const lightTheme = document.querySelector('link[href*="atom-one-light"]');
			const darkTheme = document.getElementById('hljs-dark-theme');

			if (isDark) {
				if (lightTheme) lightTheme.disabled = true;
				if (darkTheme) darkTheme.disabled = false;
			} else {
				if (lightTheme) lightTheme.disabled = false;
				if (darkTheme) darkTheme.disabled = true;
			}

			document.querySelectorAll('pre code').forEach((block) => {
				hljs.highlightElement(block);
			});
		}


		// ============================================================
		// 5. 页面控制
		// ============================================================

		function showPage(pageKey) {
			const pages = ['home', 'article', 'paste', 'not-found', 'services-list', 'services-detail'];

			pages.forEach(k => {
				const el = document.getElementById(`${k}-page`);
				if (el) el.style.display = 'none';
			});

			const target = document.getElementById(`${pageKey}-page`);
			if (target) {
				target.style.display = 'block';

				if (['article', 'paste', 'services-detail'].includes(pageKey)) {
					const contentEl = document.getElementById(`${pageKey}-content`) || document.getElementById('service-content');
					if (contentEl) {
						contentEl.innerHTML = '<div class="loading"><i class="fa-solid fa-spinner"></i><span>加载中...</span></div>';
					}
				}
			}

			document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));

			const pageMap = {
				'home': 'home',
				'article': 'articles',
				'paste': 'clipboard',
				'services-list': 'services',
				'services-detail': 'services'
			};

			const activePage = pageMap[pageKey];
			if (activePage) {
				const activeEl = document.querySelector(`.nav-item[data-page="${activePage}"]`);
				if (activeEl) activeEl.classList.add('active');
			}
		}

		// ============================================================
		// 6. 图标渲染（支持 SVG 或 FontAwesome）
		// ============================================================

		/**
		 * 渲染服务图标
		 * 优先级：iconSvg > icon > 默认图标
		 * @param {Object} svc - 服务对象
		 * @param {number} size - 图标尺寸（仅 SVG 有效）
		 * @param {string} extraClass - 额外 CSS 类名
		 * @returns {string} - 图标 HTML
		 */
		function renderServiceIcon(svc, size = 24, extraClass = '') {
			// 优先使用 SVG 图标
			if (svc.iconSvg && svc.iconSvg.trim().startsWith('<svg')) {
				// 清理 SVG 字符串，提取内部内容
				const svgContent = svc.iconSvg.replace(/<svg[^>]*>|<\/svg>/g, '').trim();
				return `
            <svg class="service-icon ${extraClass}" 
                 xmlns="http://www.w3.org/2000/svg" 
                 width="${size}" 
                 height="${size}" 
                 viewBox="0 0 28 28" 
                 fill="none" 
                 stroke="currentColor" 
                 stroke-linecap="round" 
                 stroke-linejoin="round">
                ${svgContent}
            </svg>
        `;
			}

			if (svc.icon) {
				return `<i class="${svc.icon} ${extraClass}"></i>`;
			}

			return `<i class="fa-solid fa-puzzle-piece ${extraClass}"></i>`;
		}


		// ============================================================
		// 7. 服务数据加载与渲染
		// ============================================================

		function renderStatusBadge(status) {
			const statusMap = {
				'active': { text: '活跃', class: 'status-active', icon: 'fa-circle-check' },
				'maintenance': { text: '维护中', class: 'status-maintenance', icon: 'fa-screwdriver-wrench' },
				'inactive': { text: '已停用', class: 'status-inactive', icon: 'fa-circle-xmark' },
				'deprecated': { text: '已废弃', class: 'status-deprecated', icon: 'fa-triangle-exclamation' }
			};

			const s = statusMap[status] || statusMap['inactive'];
			return `<span class="status-badge ${s.class}"><i class="fa-solid ${s.icon}"></i>${s.text}</span>`;
		}

		async function fetchServicesData() {
			try {
				const res = await fetch('https://raw.githubusercontent.com/Snow-Domain-Smart-Fox/test-data/refs/heads/main/services.json', { cache: 'no-cache' });
				if (!res.ok) throw new Error('加载失败');
				return await res.json();
			} catch (e) {
				console.error('Failed to load services:', e);
				return { services: [] };
			}
		}

		function renderServiceCard(svc) {
			const tags = (svc.tags || []).map(t => `<span class="service-tag">${escapeHtml(t)}</span>`).join('');
			const iconHtml = renderServiceIcon(svc, 28, 'service-card-icon');
			const statusBadge = renderStatusBadge(svc.status);
			const linkBtn = svc.link ? `
				<a href="${escapeHtml(svc.link)}" target="_blank" rel="noopener noreferrer" class="service-link-btn" onclick="event.stopPropagation()">
					<i class="fa-solid fa-arrow-up-right-from-square"></i>
				</a>
			` : '';

			return `
				<div class="service-card ${svc.status === 'maintenance' ? 'service-card-maintenance' : ''}" data-id="${svc.id}" onclick="navigateToService('${svc.id}')">
					<div class="service-card-header">
						${iconHtml}
						<h3 class="service-card-title">${escapeHtml(svc.name)}</h3>
						${linkBtn}
					</div>
					<div class="service-card-meta">
						${statusBadge}
					</div>
					<p class="service-card-desc">${escapeHtml(svc.description || '')}</p>
					<div class="service-tags">${tags}</div>
				</div>
			`;
		}

		function renderServicesGrid(services) {
			const grid = document.getElementById('services-grid');
			const empty = document.getElementById('services-empty');

			if (services.length === 0) {
				grid.innerHTML = '';
				empty.style.display = 'block';
				return;
			}

			empty.style.display = 'none';
			grid.innerHTML = services.map(renderServiceCard).join('');
		}

		async function loadServicesList() {
			showPage('services-list');
			updateBreadcrumb([
				{ text: '首页', href: '/' },
				{ text: '服务列表', href: '/services/list' }
			]);

			const grid = document.getElementById('services-grid');
			const loading = document.getElementById('services-loading');
			const empty = document.getElementById('services-empty');
			const categoryFilter = document.getElementById('categoryFilter');

			grid.innerHTML = '';
			loading.style.display = 'flex';
			empty.style.display = 'none';

			const data = await fetchServicesData();
			const services = data.services || [];

			const categories = [...new Set(services.map(s => s.category).filter(Boolean))];
			categoryFilter.innerHTML = '<option value="">全部分类</option>' +
				categories.map(c => `<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join('');

			renderServicesGrid(services);
			loading.style.display = 'none';

			document.getElementById('serviceSearch').oninput = filterServices;
			categoryFilter.onchange = filterServices;
		}

		function filterServices() {
			const keyword = document.getElementById('serviceSearch').value.toLowerCase();
			const category = document.getElementById('categoryFilter').value;

			fetchServicesData().then(data => {
				let filtered = data.services || [];

				if (keyword) {
					filtered = filtered.filter(s =>
						s.name.toLowerCase().includes(keyword) ||
						(s.description || '').toLowerCase().includes(keyword) ||
						(s.tags || []).some(t => t.toLowerCase().includes(keyword))
					);
				}

				if (category) {
					filtered = filtered.filter(s => s.category === category);
				}

				renderServicesGrid(filtered);
			});
		}

		async function loadServiceDetail(id) {
			showPage('services-detail');
			updateBreadcrumb([
				{ text: '首页', href: '/' },
				{ text: '服务列表', href: '/services/list' },
				{ text: id, href: `/services/${id}` }
			]);

			const contentEl = document.getElementById('service-content');
			const metaEl = document.getElementById('service-meta');
			const updateTimeEl = document.getElementById('serviceUpdateTime');

			contentEl.innerHTML = '<div class="loading"><i class="fa-solid fa-spinner"></i><span>加载中...</span></div>';

			const data = await fetchServicesData();
			const svc = (data.services || []).find(s => s.id === id);

			if (!svc) {
				contentEl.innerHTML = `
            <div class="empty-state">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <p>服务不存在</p>
            </div>
        `;
				return;
			}

			const statusBadge = renderStatusBadge(svc.status);
			const actionBtns = `
        <button class="action-btn" onclick="history.back()">
            <i class="fa-solid fa-arrow-left"></i> 返回
        </button>
        <button class="action-btn" id="copyServiceLink">
            <i class="fa-solid fa-link"></i> 复制链接
        </button>
        ${svc.link ? `
        <a href="${escapeHtml(svc.link)}" target="_blank" rel="noopener noreferrer" class="action-btn service-visit-btn">
            <i class="fa-solid fa-arrow-up-right-from-square"></i> 访问服务
        </a>
        ` : ''}
        <span class="save-time" id="serviceUpdateTime"></span>
    `;
			document.querySelector('.article-header').innerHTML = actionBtns;

			const iconHtml = renderServiceIcon(svc, 20, 'service-meta-icon');
			metaEl.innerHTML = `
        <span class="service-meta-item">${iconHtml}</span>
        <span class="service-meta-item">${statusBadge}</span>
        <span class="service-meta-item"><i class="fa-solid fa-tag"></i>${escapeHtml(svc.category || '未分类')}</span>
        <span class="service-meta-item"><i class="fa-solid fa-user"></i>${escapeHtml(svc.author || '匿名')}</span>
        <span class="service-meta-item"><i class="fa-solid fa-clock"></i>${new Date(svc.updatedAt).toLocaleString('zh-CN')}</span>
    `;
			updateTimeEl.textContent = `更新于 ${new Date(svc.updatedAt).toLocaleDateString('zh-CN')}`;

			if (svc.status === 'maintenance') {
				const noticeHtml = `
            <div class="notice important-notice">
                <h2><i class="fa-solid fa-screwdriver-wrench"></i> 维护通知</h2>
                <p>该服务当前处于维护状态，部分功能可能不可用。请稍后再试。</p>
            </div>
        `;
				contentEl.innerHTML = noticeHtml + renderMarkdown(svc.content || '');
			} else {
				contentEl.innerHTML = renderMarkdown(svc.content || '');
			}

			updateHighlightTheme();

			document.getElementById('copyServiceLink').onclick = () => {
				navigator.clipboard.writeText(location.href).then(() => {
					const btn = document.getElementById('copyServiceLink');
					const original = btn.innerHTML;
					btn.innerHTML = '<i class="fa-solid fa-check"></i> 已复制';
					setTimeout(() => btn.innerHTML = original, 1500);
				});
			};
		}


		// ============================================================
		// 8. 路由导航
		// ============================================================

		function navigateToService(id) {
			history.pushState({}, '', `/services/${id}`);
			parseRoute();
		}

		function navigateToServicesList() {
			history.pushState({}, '', '/services/list');
			parseRoute();
		}

		const originalParseRoute = window.parseRoute || function () { };

		window.parseRoute = function () {
			const path = window.location.pathname;

			if (path.startsWith('/services/list')) {
				loadServicesList();
			} else if (path.startsWith('/services/')) {
				const id = path.split('/')[2];
				if (id && id !== 'list') {
					loadServiceDetail(id);
				} else {
					showPage('not-found');
				}
			} else {
				originalParseRoute();
			}
		};


		// ============================================================
		// 9. 初始化
		// ============================================================

		document.addEventListener('DOMContentLoaded', () => {
			parseRoute();
			setTimeout(hideGlobalLoading, 300);

			document.querySelectorAll('.nav-item').forEach(el => {
				el.addEventListener('click', function (e) {
					if (this.dataset.page) {
						document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
						this.classList.add('active');
					}
				});
			});
		});

		window.addEventListener('popstate', parseRoute);

		function showGlobalLoading() {
			document.getElementById('global-loading')?.classList.remove('hidden');
		}

		function hideGlobalLoading() {
			document.getElementById('global-loading')?.classList.add('hidden');
		}
	</script>
</body>

</html>
